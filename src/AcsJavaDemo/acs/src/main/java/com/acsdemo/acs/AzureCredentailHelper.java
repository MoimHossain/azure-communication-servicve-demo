package com.acsdemo.acs;
import com.azure.core.credential.*;
import com.azure.identity.DefaultAzureCredentialBuilder;

import org.springframework.core.env.Environment;

public class AzureCredentailHelper {
    private Environment environment;

    public AzureCredentailHelper(Environment env) {
        this.environment = env;

    }

    public TokenCredential getCredential() {
        TokenCredential tokenCredentail;
        var userAssignedManagedIdentity = environment.getProperty("AZ_UAMI_CLIENTID", "");
        
        if (userAssignedManagedIdentity == "") {
            tokenCredentail = new DefaultAzureCredentialBuilder().build();
        } else {
            tokenCredentail = new DefaultAzureCredentialBuilder()
                .managedIdentityClientId(userAssignedManagedIdentity)
                .build();
        }
        return tokenCredentail;
    }
}
